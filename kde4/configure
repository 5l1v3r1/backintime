#!/bin/bash

CHECK="--check"
SUDO="--kdesudo"

for arg in $*; do
	case $arg in
		--check | --no-check) CHECK=$arg;;
		--kdesu | --kdesudo) SUDO=$arg;;
	esac
done

#check KDE4
if [ $CHECK = "--check" ]; then
	if [ -z `which kdeinit4` ]; then
		echo "ERROR: Can't find KDE4 !"
		exit 1
	fi
fi

#set sudo
case $SUDO in
	--kdesudo) sed -i -e "s/Exec=\(.*\)backintime-kde4/Exec=kdesudo -c backintime-kde4/" backintime-kde4-root.desktop;;
	--kdesu)   sed -i -e "s/Exec=\(.*\)backintime-kde4/Exec=kdesu -c backintime-kde4/" backintime-kde4-root.desktop;;
esac

cp Makefile.template Makefile

echo "All OK. Now run:"
echo "    make"
echo "    sudo make install"

